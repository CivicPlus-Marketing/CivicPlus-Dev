import { __decorate, __metadata } from "tslib";
import { Extension } from '@roots/bud-framework/extension';
import { expose } from '@roots/bud-framework/extension/decorators/expose';
import { label } from '@roots/bud-framework/extension/decorators/label';
import { production } from '@roots/bud-framework/extension/decorators/production';
import BudMinimizeCSS from '@roots/bud-minify/minify-css';
import BudMinimizeJS from '@roots/bud-minify/minify-js';
import { bind } from '@roots/bud-support/decorators/bind';
/**
 * Minimizer configuration
 */
let BudMinimize = class BudMinimize extends Extension {
    /**
     * {@link Extension.buildBefore}
     */
    async buildBefore(bud) {
        bud.hooks.on(`build.optimization.minimize`, () => true);
    }
    /**
     * {@link Extension.register}
     */
    async register(bud) {
        await bud.extensions.add(BudMinimizeCSS);
        await bud.extensions.add(BudMinimizeJS);
        this.js = bud.extensions.get(`@roots/bud-minify/minify-js`);
        this.css = bud.extensions.get(`@roots/bud-minify/minify-css`);
        bud.set(`terser`, this.js);
        bud.set(`minimizeCss`, this.css);
    }
};
__decorate([
    bind,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Function]),
    __metadata("design:returntype", Promise)
], BudMinimize.prototype, "buildBefore", null);
__decorate([
    bind,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Function]),
    __metadata("design:returntype", Promise)
], BudMinimize.prototype, "register", null);
BudMinimize = __decorate([
    label(`@roots/bud-minify`),
    expose(`minify`),
    production
], BudMinimize);
export default BudMinimize;
