import join from 'lodash/join.js';
/**
 * Packages in the `@wordpress` namespace which
 * should not be considered as external
 */
const OMIT_PACKAGE_MATCHES = [`@wordpress/icons`, `@wordpress/interface`];
/**
 * Pkg map
 */
const packageMap = new Map([
    [
        `jquery`,
        {
            enqueue: `jquery`,
            window: join([`jQuery`], `.`),
        },
    ],
    [
        `lodash`,
        {
            enqueue: `lodash`,
            window: join([`lodash`], `.`),
        },
    ],
    [
        `react-dom`,
        {
            enqueue: `react-dom`,
            window: join([`ReactDOM`], `.`),
        },
    ],
    [
        `react`,
        {
            enqueue: `react`,
            window: join([`React`], `.`),
        },
    ],
]);
/**
 * Camelize wordpress package name
 */
const camelize = (packageName) => packageName.replace(/-(.)/g, (_m, g) => g.toUpperCase());
/**
 * Transform wordpress package name
 */
const transformPackageName = (packageName) => packageName.replace(/^@wordpress\/(.*)$/, (_m, g) => g);
/**
 * Is pkg string a wordpress window var match
 */
export const isProvided = packageName => {
    if (!packageName || OMIT_PACKAGE_MATCHES.includes(packageName))
        return false;
    return (packageName.includes(`@wordpress`) ||
        Array.from(packageMap.keys()).includes(packageName));
};
/**
 * Transform pkg string request
 */
export const transform = (packageName) => {
    const transformedPackageName = transformPackageName(packageName);
    if (packageMap.has(packageName))
        return packageMap.get(packageName);
    if (isProvided(packageName)) {
        return {
            enqueue: join([`wp`, transformedPackageName], `-`),
            window: [`wp`, camelize(transformedPackageName)],
        };
    }
};
/**
 * Externals plugin
 */
export const externals = ({ _context, request }, callback) => isProvided(request)
    ? callback(null, transform(request).window)
    : callback();
